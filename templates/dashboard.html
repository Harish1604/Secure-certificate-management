{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="card">
    <h1>Welcome, {{ session.username }}!</h1>
    <p style="color: #666;">Role: <strong>{{ session.role|upper }}</strong></p>
</div>

{% if session.role == 'student' %}
<!-- STUDENT DASHBOARD -->
<div class="card">
    <h2>My Certificate Requests</h2>
    <a href="{{ url_for('request_certificate') }}" class="btn">New Certificate Request</a>

    {% if data.requests %}
    <table>
        <thead>
            <tr>
                <th>Request ID</th>
                <th>Certificate Type</th>
                <th>Status</th>
                <th>Requested On</th>
            </tr>
        </thead>
        <tbody>
            {% for req in data.requests %}
            <tr>
                <td>#{{ req.id }}</td>
                <td>{{ req.certificate_type }}</td>
                <td>
                    {% if req.status == 'Approved' %}
                    <span class="security-badge valid">{{ req.status }}</span>
                    {% else %}
                    <span class="security-badge" style="background: #ffc107; color: #000;">{{ req.status }}</span>
                    {% endif %}
                </td>
                <td>{{ req.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; margin-top: 20px;">No requests yet. Create your first request!</p>
    {% endif %}
</div>

<div class="card">
    <h2>My Certificates</h2>
    {% if data.certificates %}
    <table>
        <thead>
            <tr>
                <th>Certificate ID</th>
                <th>Type</th>
                <th>Issued On</th>
                <th>Security</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for cert in data.certificates %}
            <tr>
                <td>#{{ cert.id }}</td>
                <td>{{ cert.certificate_type }}</td>
                <td>{{ cert.issued_at }}</td>
                <td>
                    <span class="security-badge encrypted">AES Encrypted</span>
                    <span class="security-badge signed">RSA Signed</span>
                </td>
                <td>
                    <a href="{{ url_for('download_certificate', certificate_id=cert.id) }}"
                        class="btn btn-success">Download</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; margin-top: 20px;">No certificates issued yet.</p>
    {% endif %}
</div>

{% elif session.role == 'admin' %}
<!-- ADMIN DASHBOARD -->
<div class="card">
    <h2>Pending Certificate Requests</h2>
    {% if data.pending_requests %}
    <table>
        <thead>
            <tr>
                <th>Request ID</th>
                <th>Student</th>
                <th>Certificate Type</th>
                <th>Requested On</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for req in data.pending_requests %}
            <tr>
                <td>#{{ req.id }}</td>
                <td>{{ req.student }}</td>
                <td>{{ req.certificate_type }}</td>
                <td>{{ req.created_at }}</td>
                <td>
                    <form method="POST" action="{{ url_for('approve_certificate_request', request_id=req.id) }}"
                        style="display: inline;">
                        <button type="submit" class="btn btn-success">Approve & Upload</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; margin-top: 20px;">No pending requests.</p>
    {% endif %}
</div>



{% elif session.role == 'verifier' %}
<!-- VERIFIER DASHBOARD -->
<div class="card">
    <h2>Certificate Verification</h2>
    <p style="color: #666; margin-bottom: 20px;">
        As a verifier, you can independently verify the authenticity of any certificate.
    </p>
    <a href="{{ url_for('verify') }}" class="btn">Verify Certificate</a>
</div>

<div class="card">
    <h3>Verification Process</h3>
    <ol style="color: #666; line-height: 2;">
        <li>Decrypt AES key using RSA private key</li>
        <li>Decrypt certificate file using AES key</li>
        <li>Recalculate SHA-256 hash of encrypted file</li>
        <li>Verify digital signature using RSA public key</li>
        <li>Display VALID or TAMPERED status</li>
    </ol>
</div>
{% endif %}
{% endblock %}